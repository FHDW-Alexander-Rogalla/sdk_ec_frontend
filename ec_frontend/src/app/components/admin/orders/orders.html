<div class="admin-orders-container">
  <div class="admin-header">
    <h1>Order Management</h1>
    <p class="subtitle">Manage all customer orders and update their status</p>
  </div>

  @if (orders().length === 0) {
    <div class="empty-state">
      <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
        <path d="M9 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8l-6-6z"></path>
        <path d="M9 2v6h6"></path>
      </svg>
      <h2>No Orders Found</h2>
      <p>There are no orders in the system yet.</p>
    </div>
  } @else {
    <div class="orders-grid">
      @for (order of orders(); track trackByOrderId($index, order)) {
        <div class="order-card">
          <!-- Order Header -->
          <div class="order-header">
            <div class="order-header-left">
              <div class="order-id">#{{ order.id }}</div>
              <div class="order-date">{{ formatDate(order.orderDate) }}</div>
            </div>
            <div class="order-header-right">
              @if (editingOrderId === order.id) {
                <button class="btn-save-header" (click)="saveStatus(order.id)" title="Save">
                  <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                    <polyline points="20 6 9 17 4 12"></polyline>
                  </svg>
                </button>
                <button class="btn-cancel-header" (click)="cancelEdit()" title="Cancel">
                  <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                  </svg>
                </button>
                <select 
                  [(ngModel)]="selectedStatus" 
                  class="status-select"
                  (keydown.escape)="cancelEdit()"
                  (keydown.enter)="saveStatus(order.id)">
                  @for (status of statusOptions; track status) {
                    <option [value]="status">{{ formatStatus(status) }}</option>
                  }
                </select>
              } @else {
                <button class="btn-edit-header" (click)="startEdit(order)" title="Edit Status">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                    <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                  </svg>
                </button>
                <span class="status-badge" [ngClass]="getStatusClass(order.status)">
                  {{ formatStatus(order.status) }}
                </span>
              }
            </div>
          </div>

          <!-- Order Info -->
          <div class="order-info">
            <div class="info-row">
              <div class="info-label">Customer:</div>
              <div class="info-value">
                <div class="customer-name">{{ getUserDisplay(order) }}</div>
                @if (order.userId) {
                  <div class="customer-id">{{ order.userId.substring(0, 8) }}...</div>
                }
              </div>
            </div>
            <div class="info-row">
              <div class="info-label">Items:</div>
              <div class="info-value">{{ order.items.length }} {{ order.items.length === 1 ? 'item' : 'items' }}</div>
            </div>
            <div class="info-row">
              <div class="info-label">Total:</div>
              <div class="info-value order-total">{{ order.totalAmount | currency:'EUR' }}</div>
            </div>
          </div>

          <!-- Order Items -->
          <div class="order-items-section">
            <h4 class="section-title">Order Items</h4>
            <div class="items-list">
              @if (order.items && order.items.length > 0) {
                @for (item of order.items; track item.id) {
                  <div class="item-card">
                    @if (item.product && item.product.imageUrl) {
                      <img [src]="item.product.imageUrl" [alt]="item.product.name || 'Product'" class="item-image">
                    } @else {
                      <div class="item-image-placeholder">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                          <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                          <circle cx="8.5" cy="8.5" r="1.5"></circle>
                          <polyline points="21 15 16 10 5 21"></polyline>
                        </svg>
                      </div>
                    }
                    <div class="item-info">
                      <div class="item-name">
                        {{ item.product?.name || ('Product #' + item.productId) }}
                        @if (!item.product) {
                          <span class="loading-indicator">(Loading...)</span>
                        }
                      </div>
                      <div class="item-meta">
                        <span>Qty: {{ item.quantity }}</span>
                        <span>Ã—</span>
                        <span>{{ item.priceAtPurchase | currency:'EUR' }}</span>
                        <span>=</span>
                        <span class="item-subtotal">{{ item.quantity * item.priceAtPurchase | currency:'EUR' }}</span>
                      </div>
                    </div>
                  </div>
                }
              } @else {
                <div class="no-items">No items in this order</div>
              }
            </div>
          </div>

          <!-- Order Actions
          <div class="order-actions">
            <div class="action-info">Order details displayed above</div>
          </div> -->
        </div>
      }
    </div>
  }
</div>

